---
- name: deployment
  hosts: "{{ ansible_limit | default('localhost') }}"
  connection: "{{ 'local' if ansible_limit == 'localhost' else 'ssh' }}"
  gather_facts: false
  become: false
  vars:
    ansible_python_interpreter: /home/mark/.pyenv/shims/python3
  tasks:
    - name: Dump the version
      ansible.builtin.debug:
        msg: "Deploying version {{ lookup('pipe', 'cat ../VERSION') }}"
    - name: Include deployment role (deployment tasks)
      ansible.builtin.include_role:
        name: deployment
        tasks_from: deployment.yml
      vars:
        context: thinkpad
        image:
          name: mamercad/snakebot
          tag: "{{ lookup('pipe', 'cat ../VERSION') }}"
        service:
          port: 3000
        secret:
          SLACK_SIGNING_SECRET: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            30313235313734633366353636356466626166386433316430393538353439303238396235653931
            3932383062626231623736363738346439366664623161660a336264313238653132393134333536
            39343238633433666432306636656436616631373332626462306538383531633839343165656234
            6265356633316662370a393932303537613739376638313730376362663462646538326431646461
            39636361336335366438353733373962333865383133386634333934393839313861633462656532
            3362653438363635396239306232616264376264343637366335
          SLACK_BOT_TOKEN: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            34613464623437643533373664353562323535643331663561353432363064653262386233313139
            3034373037383061346636313930373030383963333862620a656666313061336230336465303436
            37306430366562356231376661373037313239306136383264666439653361303963633138666663
            3035646436663638620a386337653132396263663334653731666266616563333634333161326130
            61323962373635663538653262383833393932303831396362313739353438623833343061353732
            32643537303736613638383039346139333431363337616364373566393361663966623463303035
            32333733393965663462663966326333616564336134373463393134363936663362323661353039
            32613064303231316138
          DISCORD_WEBHOOK: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            65313038616632653962633235656561613062636532666664333537656130366462333763316336
            3132383135376434356561623364643135373162656466630a306564646163363831666562633363
            35613833613931363964376566306439333131356663623266346331376431366633613834353635
            3738363539356461320a316365366162663736373331313763646464353638626366353130386132
            64303831313366656633613436633665353334316164643365366462316233363035363031363934
            36323865373734656436396437303963376634646334343535353536376430356232613664373834
            35653833303430373737656134336263626234633831366363313630633538323164386363316636
            33393862396431633730633365643666363263623432383538376464646436323933356630633238
            34623338636163643465363239613336363361623862656161363564643262323333366433336662
            34303531363435313366376537393439663661306364636336623664393836303738306463346463
            64373435633630376133303039626665656562366362333830383434346238303566396134333162
            62376662643465316235643461663266323134646132646136383233386135616264353737653862
            3239
